#Дипломная работа легкого уровня
# Работа с API

# Старт дипломной работы: 17.01
# Предварительный срок сдачи: 21.01
# Дедлайн (последний срок сдачи): 21:00 Мск 23.01
# --------------------------------------------------

# 1. Устанавливаем нужные библиотеки.
# 2.Спросить пользователя, хочет ли он узнать погоду в каком то городе.
# 3.Спросить пользователя название города на русском языке, в котором он хочет узнать текущую погоду.
#     1.Да - продолжить.
#     2.Нет - закиончить программу.
# 4 Поросить ввести название города на русском языке.
#     1.Если в слове присутствуют значения не являющимися буквами русского языка, указать пользователю на ошибку и повторить запрос.
#    2. Если слово написано русскими буквами отправить запрос. Через title контролируем, что бы первашбуква была заглавной , а остальные строчными.
# 5. Отправить запрос на https://www.weatherbit.io/api на русском языке и указании температуры в градусах цельсия.
#    1. Если на запрос поступил отрицательный ответ, указать пользователю на ошыбку и попросить написать название города правильно или вернуться к началу программы.
#    2. Если поступил ответ на запрос, переходим к следуюшему пункту.
# 6. Обрабатываем ответ на запрос.
# 7. Выводим пользователю полученный результат на русском языке.
# 8. Возвращаем пользователя к началу программы и спрашиваем пользователя, хотел бы он сделать ещё один запрос:
#    1. Да - запускаем программу.
#    2. Нет - конец программы.

# -----------------------------------------------------------------------------

import requests
import sys



apikey = '9d8b0ead24a0440dae8ecb2f1bde71f3'
units = 'm'
language = 'ru'


d = True
while d == True:
    x = True
    while x == True:
        user_question_new = input('Вы хотите сделать запрос погоды? Да/Нет\n')
        if user_question_new.upper() == 'ДА':

            y = True
            while y == True:
                city_user = input('Введите название города на русском языке: ')
                for i in range(0, len(city_user)):
                    if ord(city_user[i]) < 1040 or ord(city_user[i]) > 1103:
                            print('Вводите пожалуйста буквы русского алфавита.')
                            break


                city = city_user.title()
                url = f'https://api.weatherbit.io/v2.0/current?city={city}&key={apikey}&lang={language}&units={units}'

                r = requests.get(url)

                if str(r) != "<Response [200]>":
                    print('Неправильно введено название города или такого города нет в банке данных.')
                    user_key = input('Если хотите вернуться к началу программы введите букву "н" , или любую другую букву если хотите ввести повторно название города')

                    if user_key == 'н':
                        d = False
                        y = False

                        break

                else:
                    path = r.json()['data'][0]

                    print(f' Сегодня в городе {city} -', path['weather']['description'], ' , влажность', path['rh'], '%, температура ', path['temp'], ' градусов , которая ощущается как температура в ', path['app_temp'], ' градусов,при скоростио ветра', path['wind_spd'], ' метров в секунду . Ветер ', path['wind_cdir_full'])

                    break

        else:
            x = False
            d = False


print('Ciao!')
